<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 7 - Bài 4: Employee Management - REST Consumer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; padding: 20px 0; }
        .card { border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .table th { background-color: #e53935; color: white; }
        .btn-action { width: 35px; height: 35px; padding: 0; }
    </style>
</head>
<body>
<div class="container">
    <div class="card shadow-lg mt-4">
        <div class="card-header bg-primary text-white text-center py-4">
            <h2><i class="fas fa-users-cog"></i> QUẢN LÝ NHÂN VIÊN - REST API + FETCH</h2>
        </div>
        <div class="card-body p-5">

            <!-- Form thêm/sửa -->
            <div class="row g-3 mb-4 p-4 bg-light rounded">
                <div class="col-md-2">
                    <input type="text" id="id" class="form-control" placeholder="Mã NV" required>
                </div>
                <div class="col-md-4">
                    <input type="text" id="name" class="form-control" placeholder="Họ tên" required>
                </div>
                <div class="col-md-2 text-center">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="male" value="true" checked>
                        <label class="form-check-label" for="male">Nam</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="female" value="false">
                        <label class="form-check-label" for="female">Nữ</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <input type="number" id="salary" class="form-control" placeholder="Lương" step="0.1" required>
                </div>
                <div class="col-md-2 d-grid gap-2">
                    <button onclick="create()" class="btn btn-success"><i class="fas fa-plus"></i> Create</button>
                    <button onclick="update()" class="btn btn-warning d-none" id="btnUpdate"><i class="fas fa-save"></i> Update</button>
                    <button onclick="resetForm()" class="btn btn-secondary">Reset</button>
                </div>
            </div>

            <!-- Bảng dữ liệu -->
            <div class="table-responsive">
                <table class="table table-hover table-bordered align-middle">
                    <thead>
                    <tr>
                        <th>Mã NV</th>
                        <th>Họ tên</th>
                        <th>Giới tính</th>
                        <th>Lương</th>
                        <th>Hành động</th>
                    </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // URL API từ bài 3
    const API = "http://localhost:8080/Lab78/api/employees";

    // Load danh sách khi mở trang
    loadData();

    // Lấy tất cả nhân viên
    function loadData() {
        fetch(API)
            .then(res => res.json())
            .then(data => {
                let html = "";
                data.forEach(e => {
                    html += `<tr>
                    <td>${e.id}</td>
                    <td>${e.name}</td>
                    <td>${e.gender ? "Nam" : "Nữ"}</td>
                    <td>${e.salary.toLocaleString()} VND</td>
                    <td>
                        <button class="btn btn-sm btn-warning btn-action" onclick="edit('${e.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger btn-action" onclick="remove('${e.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
                });
                document.getElementById("tbody").innerHTML = html;
            });
    }

    // Thêm mới
    function create() {
        const emp = getFormData();
        fetch(API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(emp)
        }).then(() => {
            loadData();
            resetForm();
            alert("Thêm thành công!");
        });
    }

    // Sửa
    function edit(id) {
        fetch(API + "/" + id)
            .then(res => res.json())
            .then(e => {
                document.getElementById("id").value = e.id;
                document.getElementById("name").value = e.name;
                document.getElementById(e.gender ? "male" : "female").checked = true;
                document.getElementById("salary").value = e.salary;

                document.getElementById("btnUpdate").classList.remove("d-none");
                document.querySelector("button[onclick='create()']").classList.add("d-none");
            });
    }

    function update() {
        const emp = getFormData();
        fetch(API + "/" + emp.id, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(emp)
        }).then(() => {
            loadData();
            resetForm();
            alert("Cập nhật thành công!");
        });
    }

    // Xóa
    function remove(id) {
        if (confirm("Xóa nhân viên " + id + "?")) {
            fetch(API + "/" + id, { method: "DELETE" })
                .then(() => {
                    loadData();
                    alert("Xóa thành công!");
                });
        }
    }

    // Reset form
    function resetForm() {
        document.getElementById("id").value = "";
        document.getElementById("name").value = "";
        document.getElementById("salary").value = "";
        document.getElementById("male").checked = true;
        document.getElementById("btnUpdate").classList.add("d-none");
        document.querySelector("button[onclick='create()']").classList.remove("d-none");
    }

    // Lấy dữ liệu từ form
    function getFormData() {
        return {
            id: document.getElementById("id").value,
            name: document.getElementById("name").value,
            gender: document.getElementById("male").checked,
            salary: parseFloat(document.getElementById("salary").value)
        };
    }
</script>
</body>
</html>